{% extends "base.html" %}

{% block title %}–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ - System Info Collector{% endblock %}
{% block page_title %}üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4><i class="fas fa-users me-2"></i>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h4>
                <span class="badge bg-primary">–í—Å–µ–≥–æ: {{ users|length }}</span>
            </div>

            {% if users %}
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</th>
                            <th>–†–æ–ª—å</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users %}
                        <tr>
                            <td>{{ user.id }}</td>
                            <td>
                                {{ user.username }}
                                {% if user.username == current_user.username %}
                                <span class="badge bg-info">–í—ã</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if user.is_admin %}
                                <span class="badge bg-danger">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                                {% else %}
                                <span class="badge bg-secondary">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if user.is_active %}
                                <span class="badge bg-success">–ê–∫—Ç–∏–≤–µ–Ω</span>
                                {% else %}
                                <span class="badge bg-warning">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>
                                {% endif %}
                            </td>
                            <td>{{ user.created_at[:16] }}</td>
                            <td>
                                {% if user.username != current_user.username %}
                                <div class="btn-group btn-group-sm">
                                    <button type="button" class="btn btn-outline-primary"
                                            data-bs-toggle="modal"
                                            data-bs-target="#passwordModal{{ user.id }}">
                                        <i class="fas fa-key"></i>
                                    </button>
                                    <form action="{{ url_for('toggle_user_route', user_id=user.id) }}" method="POST" style="display: inline;">
                                        <button type="submit" class="btn btn-outline-{{ 'warning' if user.is_active else 'success' }}"
                                                onclick="return confirm('{{ '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' if user.is_active else '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' }} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ user.username }}?')">
                                            <i class="fas fa-{{ 'ban' if user.is_active else 'check' }}"></i>
                                        </button>
                                    </form>
                                </div>
                                {% else %}
                                <span class="text-muted">–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
                                {% endif %}
                            </td>
                        </tr>

                        <!-- Modal –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è -->
                        <div class="modal fade" id="passwordModal{{ user.id }}" tabindex="-1">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è –¥–ª—è {{ user.username }}</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                    </div>
                                    <form action="{{ url_for('change_password_route', user_id=user.id) }}" method="POST">
                                        <div class="modal-body">
                                            <div class="mb-3">
                                                <label for="new_password{{ user.id }}" class="form-label">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                                                <input type="password" class="form-control" id="new_password{{ user.id }}"
                                                       name="new_password" required minlength="6">
                                                <div class="form-text">–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤</div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                                            <button type="submit" class="btn btn-primary">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-5">
                <i class="fas fa-users fa-3x text-muted mb-3"></i>
                <h5 class="text-muted">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h5>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="col-md-4">
        <div class="stat-card">
            <h4><i class="fas fa-user-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h4>
            <form action="{{ url_for('create_user_route') }}" method="POST">
                <div class="mb-3">
                    <label for="username" class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" class="form-control" id="username" name="username" required>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" class="form-control" id="password" name="password" required minlength="6">
                </div>
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="is_admin" name="is_admin">
                    <label class="form-check-label" for="is_admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</label>
                </div>
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-plus me-2"></i>–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                </button>
            </form>
        </div>

        <div class="stat-card mt-4">
            <h5><i class="fas fa-info-circle me-2"></i>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
            <ul class="list-unstyled">
                <li><i class="fas fa-shield-alt text-primary me-2"></i>–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</li>
                <li><i class="fas fa-ban text-warning me-2"></i>–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</li>
                <li><i class="fas fa-key text-success me-2"></i>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –ø–∞—Ä–æ–ª–∏</li>
            </ul>
        </div>
    </div>
</div>
<!-- –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞ users.html, –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º –±–ª–æ–∫–æ–º content -->
{% if current_user.is_admin %}
<!-- Modal –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
<div class="modal fade" id="changeAdminPasswordModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form action="{{ url_for('change_own_password_route') }}" method="POST">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="old_password" class="form-label">–°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-control" id="old_password"
                               name="old_password" required>
                    </div>
                    <div class="mb-3">
                        <label for="new_password" class="form-label">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-control" id="new_password"
                               name="new_password" required minlength="6">
                    </div>
                    <div class="mb-3">
                        <label for="confirm_password" class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è</label>
                        <input type="password" class="form-control" id="confirm_password"
                               name="confirm_password" required minlength="6">
                    </div>
                    <div class="form-text">
                        –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}